<script type="text/javascript">
    
    cubeVizApp._.backend.uiParts.index.isLoaded = true;
    
    cubeVizApp
        .add("View_IndexAction_Header", "#cubeviz-index-headerDialogBox")
        .add("View_IndexAction_Visualization", "#cubeviz-index-visualization")
        .add("View_IndexAction_VisualizationSelector", "#cubeviz-visualizationselector-menuItems")
        .add("View_IndexAction_Legend", "");
</script>

<div style="margin-left: 6px; margin-top: 10px;">
    <!-- Header -->
    <h2 id="cubeviz-index-header"></h2>

    <!-- Visualization -->
    <div id="cubeviz-index-visualization"></div>
    
    <br/>
    <br/>

    <!-- Legend part -->
    <div id="cubeviz-index-legend">
        
        <span style="vertical-align: middle;">
            <strong>Show Information About</strong> &nbsp;
        </span>
        
        <!-- Information about the components -->
        <a class="btn btn-small" id="cubeviz-legend-btnShowSelectedConfiguration">
            <i class="icon-chevron-down"></i> &nbsp;
            <?php echo $this->_translate->_('Selected Configuration'); ?>
        </a>
        
        &nbsp;
        
        <!-- Information about the observations itself -->
        <a class="btn btn-small" id="cubeviz-legend-btnShowRetrievedObservations">
            <i class="icon-chevron-down"></i> &nbsp;
            <?php echo $this->_translate->_('Retrieved Data'); ?>
        </a>
        
        <!-- Selected configuration -->
        <div id="cubeviz-legend-selectedConfiguration" style="display: none;">
            <br/>
            <h2>Information About Selected Configuration</h2>
            
            <div id="cubeviz-legend-dsdAndDs"></div>
            <div id="cubeviz-legend-components"></div>
        </div>
        
        <!-- Retrieved observations -->
        <div id="cubeviz-legend-retrievedObservations" style="display: none; clear: both;">
            <br/>
            <h2>Information About Retrieved Data</h2>
            
            <ul id="cubeviz-legend-observations"></ul>
            <div style="float: right; margin-right: 10px;">
                <p>
                    <a class="btn btn-small" id="cubeviz-legend-sortByTitle">
                        <strong>Sort by Title</strong></a>
                    <a class="btn btn-small" id="cubeviz-legend-sortByValue">
                        <strong>Sort by Value</strong></a>
                </p>
            </div>
        </div>
    </div>

    <!-- Visualization selector -->
    <div id="cubeviz-visualizationselector-selector"></div>

    <!-- Visualization selector > menu + dongle -->    
    <div id="cubeviz-visualizationselector-menu">
        
        <strong>
            <?php echo $this->_translate->_('Configure the visualization'); ?>
        </strong>
        <div style="height: 20px;"></div>
        <div id="cubeviz-visualizationselector-menuItems"></div>
        <br/>
        <br/>
        <br/>
        <div style="clear:both; text-align:right;">
            <a class="btn btn-small"
               id="cubeviz-visualizationselector-closeMenu"
               title="<?php echo $this->_translate->_('Close this menu without apply changes'); ?>">
                <?php echo $this->_translate->_('Close'); ?>
            </a>
            
            <a class="btn btn-small"
               id="cubeviz-visualizationselector-updateVisz"
               title="<?php echo $this->_translate->_('Update visualization based on new settings'); ?>">
                <strong><?php echo $this->_translate->_('Update'); ?></strong>
            </a>
        </div>
    </div>
    <div id="cubeviz-visualizationselector-menuDongleDiv" class="cubeviz-clickable">
        <img id="cubeviz-visualizationselector-menuDongleImg" 
              src="<?php echo $this->cubevizImagesPath; ?>menuDongle.png"/>
    </div>
</div>

<!-- 
    notification if no data were received
-->
<div id="cubeviz-visualization-nothingFoundNotificationContainer">
    <div id="cubeviz-visualization-nothingFoundBox">
        <div align="center">        
            <div id="cubeviz-visualization-nothingFoundNotification">
                No data fits to your selection, please adapt your selection in the left sidebar manually.
                <br/>
                <br/>
                
                <div id="cubeviz-visualization-nothingFoundNotificationLink">
                    <i class="icon-chevron-down" id="cubeviz-Index-NothingFoundNotificationLink"></i>
                    &nbsp;
                    <a>Why do i sometimes receive an empty chart / no data?</a>
                </div>
            </div>            
            <br/>            
            <div id="cubeviz-visualization-nothingFoundFurtherExplanation">
                <div style="float:left;">
                    <i class="icon-lightbulb"></i>
                </div>
                <div style="margin-left: 24px; margin-top:-3px;">
                    <span style="font-size:16px; font-weight:bold;">
                        Explanation
                    </span>
                    <p>
                        This behavior can have various reasons. On the one hand it
                        is possible that there is no data available according to 
                        the selection. In order to reduce the load of the server 
                        we decided not to check the availability of data for every 
                        selection. 
                        <br/>
                        <br/>
                        On the other hand it is possible that a chart can not be 
                        produced if the user selects inapplicable combinations of 
                        options such as a logarithm scale in combination 
                        with percentage stacking. Trapping such cases is not yet 
                        fully implemented but will be done soon.
                        <br/>
                        <br/>
                        To solve such problems we suggest to change the selection 
                        and/or the selected chart options.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="cubeviz-index-headerDialogBox"></div>


<!-- 
    TEMPLATES (text/template)
-->

<!-- 
    Header
-->
<script id="cubeviz-index-tpl-header" type="text/template">
    CubeViz - Visualization of the <%= modelLabel %>
    &nbsp;
    <i class="icon-lightbulb cubeviz-clickable"
       id="cubeviz-index-headerQuestionMarkHeadline" 
       title="<?php echo $this->_translate->_('Click for more information'); ?>"></i>
</script>

<!-- 
    Visualization selection menu 
-->
<script id="cubeviz-visualizationselector-tpl-selectorItem" type="text/template">
    <a class="btn cubeviz-visualizationselector-selectorItem">
        <img class="cubeviz-icon-small" 
             src="<?php echo $this->cubevizImagesPath; ?><%= icon %>"/>
    </a>
</script>

<script id="cubeviz-visualizationselector-tpl-menuItem" type="text/template">
    <div class="cubeviz-visualizationselector-menuItem" style="clear:both;">
        <div style="float:left; margin-left:3px;"><%= label %></div>
        <div style="float:right">
            <select class="cubeviz-visualizationselector-menuSelectbox cubeviz-visualizationselector-menuItemValue"></select>
        </div>
    </div>
</script>

<!-- 
    Dialog box for questionmark in headline (cubeviz-Index-questionMarkHeadline) 
-->
<script id="cubeviz-index-tpl-headerDialogBoxHead" type="text/template">
    <div style="margin-top: 4px; float: right; clear:both;">
        <img class="cubeviz-icon-small"
              src="<?php echo $this->cubevizImagesPath; ?>cubevizLogo.png"/>
    </div>
    <h3><%= label %></h3>
    <ul id="cubeviz-index-headerDialogBoxModelInformation"></ul>
</script>

<script id="cubeviz-index-tpl-headerDialogBoxEntry" type="text/template">
    <li class="cubeviz-index-headerDialogBoxEntry">
        <strong><%= predicateLabel %></strong>
        <div class="cubeviz-index-headerDialogBoxEntryContent">
            <%= objectContent %></div>
    </li>
</script>

<!-- 
    Notification if highcharts.com #10 exception appears
-->
<script id="cubeviz-visualization-tpl-notificationHightchartsException10" type="text/template">
    <div id="cubeviz-visualization-notificationHightchartsException10">
        <div style="height: 150px;">&nbsp;</div>
        <div align="center">        
            <div id="cubeviz-visualization-nothingFoundNotification">
                 That chart can not be produced because the selected data contains 
                 zero or subzero values. Please change the configuration in the 
                 left sidebar or use another Scale value but not Logarithmic.
            </div>
        </div>
    </div>
</script>

<!--
    Legend
-->
<script id="cubeviz-legend-tpl-dsdAndDs" type="text/template">
    <h3>
        <a href="<%= dsdUrl %>" target="_blank"><%= dsdLabel %></a> -
        <a href="<%= dsUrl %>" target="_blank"><%= dsLabel %></a>
    </h3>
</script>

<script id="cubeviz-legend-tpl-dimensionElementLabel" type="text/template"> 
    <a href="<%= url %>" target="_blank" title="<%= fullLabel %>"><%= shortLabel %></a>
</script>

<script id="cubeviz-legend-tpl-observation" type="text/template">
    <li>
        <span class="cubeviz-legend-observationIcon">
            <i class="icon-map-marker"></i>
        </span>
        <span>
            <span class="cubeviz-legend-observationLabel"><%= observationLabel %></span>
            
            <span class="cubeviz-legend-observationValue">
                <%= observationValue %>
            </span>
            
            <!--<%= measurePropertyValue %> - <%= measurePropertyAttribute %>-->
            
            <div style="height: 5px;"></div>
            
            <a href="<%= observationUri %>" target="_blank">Go to source</a>
            
            <div style="height: 10px;"></div>
            
            <!-- Related dimension elements -->
            <ul class="cubeviz-legend-observationInfoList"></ul>
        </span>
    </li>
</script>


<script id="cubeviz-legend-tpl-observationInfoListEntry" type="text/template"> 
    <li class="cubeviz-legend-observationInfoListEntry">
        <strong><%= dimensionLabel %>:</strong>
        <a href="<%= url %>" target="_blank" title="<%= fullLabel %>">
            <%= shortLabel %></a>
    </li>
</script>


<script id="cubeviz-legend-tpl-componentList" type="text/template"> 
    <ul id="cubeviz-legend-componentList"></ul>
</script>

<script id="cubeviz-legend-tpl-componentDimension" type="text/template"> 
    <li class="cubeviz-legend-componentDimensionListEntry">
        <h3><%= label %></h3>
        <ul class="cubeviz-legend-componentDimensionList"></ul>
    </li>
</script>

<script id="cubeviz-legend-tpl-componentDimensionEntry" type="text/template"> 
    <li class="cubeviz-legend-componentDimensionEntry">        
        <span class="cubeviz-legend-componentDimensionIcon">
            <i class="icon-leaf" style="font-size: 11px;"></i>
        </span>
        <span>
            <span style="font-size: 17px;" title="<%= fullLabel %>">
                <%= shortLabel %></span>
            <div style="height: 8px;"></div>
            <a class="cubeviz-legend-componentDimensionShowInfo">
                Show more information</a>
            <i class="icon-lightbulb cubeviz-clickable"></i>
            &nbsp;
            &nbsp;
            <a href="<%= url %>" target="_blank">Go to source</a>
        </span>
    </li>
</script>

<!-- 
    Dialog box for questionmark in headline(cubeviz-Index-questionMarkHeadline) 
-->
<div id="cubeviz-legend-componentDimensionInfoDialog"></div>

<script id="cubeviz-legend-tpl-componentDimensionInfoHeader" type="text/template">
    <h3>Information about dimension element</h3>
</script>

<script id="cubeviz-legend-tpl-componentDimensionInfoList" type="text/template">
    <ul class="cubeviz-legend-componentDimensionInfoList"></ul>
</script>

<script id="cubeviz-legend-tpl-componentDimensionInfoListEntry" type="text/template"> 
    <li>
        <br/>
        <strong><%= key %></strong>
        <br/>
        <%= value %>
    </li>
</script>


